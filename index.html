<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SUPER SALES KART : PROFESSIONAL FINAL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --kart-blue: #009dfd;
            --kart-red: #ea0012;
            --kart-yellow: #fff300;
            --kart-green: #37d300;
            --kart-dark: #121212;
            --manager-gold: #fbbf24;
            --glass-bg: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(255, 255, 255, 0.4);
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #2c3e50;
            color: #333;
            overflow-x: hidden;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0; overscroll-behavior: none;
        }

        .kart-frame {
            width: 100%; max-width: 480px; height: 100dvh; max-height: 900px;
            background: linear-gradient(to bottom, #87CEEB 0%, #E0F7FA 100%);
            position: relative; display: flex; flex-direction: column;
            box-shadow: 0 30px 60px rgba(0,0,0,0.5); overflow: hidden;
            border: 4px solid #fff; border-radius: 24px;
        }

        .road-bg {
            position: absolute; bottom: -20%; left: -50%; width: 200%; height: 60%;
            background-color: #444;
            background-image: 
                linear-gradient(90deg, transparent 49%, #fff 50%, transparent 51%),
                repeating-linear-gradient(0deg, transparent, transparent 20px, rgba(255,255,255,0.1) 21px, rgba(255,255,255,0.1) 40px);
            transform: perspective(500px) rotateX(60deg);
            animation: roadMove 1s linear infinite; pointer-events: none; z-index: 0; opacity: 0.6;
        }
        @keyframes roadMove { from { background-position: 0 0; } to { background-position: 0 80px; } }

        .hud {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px; z-index: 50; background: rgba(0, 157, 253, 0.4);
            backdrop-filter: blur(10px); border-bottom: 2px solid rgba(255,255,255,0.5); color: white;
        }
        .lap-badge { background: var(--kart-red); padding: 2px 12px; border-radius: 20px; font-weight: 700; box-shadow: 0 4px 0 #990000; }

        .scene {
            flex: 1; position: relative; z-index: 10; display: flex; flex-direction: column;
            align-items: center; padding: 20px; padding-bottom: 80px; overflow-y: auto; width: 100%;
        }
        .scene::-webkit-scrollbar { display: none; }

        .intro-logo {
            font-family: 'Fredoka', sans-serif; font-size: 44px; line-height: 1.1; font-weight: 700;
            color: #fff; text-align: center; text-shadow: 0 4px 0 var(--kart-blue), 0 8px 0 var(--kart-dark);
            transform: skewY(-5deg) rotate(-2deg); margin-bottom: 30px;
        }
        .logo-sub {
            background: var(--kart-yellow); color: #000; padding: 8px 24px; border-radius: 50px;
            font-weight: 900; display: inline-block; box-shadow: 0 5px 0 #e6a700; transform: skewY(-5deg);
            margin-bottom: 50px; font-size: 15px;
        }
        
        .kart-btn {
            background: linear-gradient(to bottom, #ff5e3a 0%, #ff2a00 100%);
            border: 2px solid rgba(255,255,255,0.5); border-radius: 50px;
            color: white; font-size: 24px; font-weight: 900; padding: 16px 60px;
            box-shadow: 0 6px 0 #cc2200; cursor: pointer; transition: 0.1s;
        }
        .kart-btn:active { transform: translateY(6px); box-shadow: none; }

        .glass-panel {
            background: var(--glass-bg); border-radius: 24px; padding: 24px; width: 100%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 20px;
            backdrop-filter: blur(10px); border: 2px solid var(--glass-border);
            transition: all 0.3s ease;
        }
        /* ê´€ë¦¬ì(íŒ€ ì •ë³´) ì…ë ¥ ì‹œ í…Œë§ˆ ë°˜ì „ */
        .glass-panel.manager-mode {
            background: rgba(18, 18, 18, 0.92);
            border-color: var(--manager-gold);
            color: white;
        }
        .glass-panel.manager-mode .q-text { color: white; }
        .glass-panel.manager-mode .input-label { color: var(--manager-gold); }

        .q-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .q-tag { background: var(--kart-blue); color: white; padding: 3px 12px; border-radius: 12px; font-size: 11px; font-weight: 800; }
        .manager-badge { background: var(--manager-gold); color: black; padding: 3px 12px; border-radius: 12px; font-size: 11px; font-weight: 900; animation: blink 1s infinite; }
        
        @keyframes blink { 50% { opacity: 0.6; } }

        .q-text { font-size: 20px; font-weight: 800; color: #2d3748; text-align: center; margin-bottom: 24px; line-height: 1.4; }

        .option-btn {
            display: block; width: 100%; text-align: left;
            background: white; border: 2px solid #eee;
            padding: 14px; margin-bottom: 10px;
            font-size: 15px; font-weight: 700; border-radius: 12px;
            box-shadow: 0 4px 0 #ddd; transition: 0.1s;
            position: relative; color: #333;
        }
        .option-btn.selected { background: #fff9c4; border-color: var(--kart-yellow); box-shadow: 0 4px 0 #fbc02d; color: black; }
        .option-btn.selected::after { content: 'ğŸ'; position: absolute; right: 15px; top: 50%; transform: translateY(-50%); }

        .option-btn.multi-selected { background: #e3f2fd; border-color: #2196f3; box-shadow: 0 4px 0 #1976d2; color: black; }
        .option-btn.multi-selected::after { content: 'âœ…'; position: absolute; right: 15px; top: 50%; transform: translateY(-50%); }

        .nav-btn {
            flex: 1; padding: 14px; text-align: center; border-radius: 16px;
            font-weight: 800; font-size: 16px; transition: transform 0.1s;
        }
        .btn-back { background: #f1f5f9; color: #64748b; box-shadow: 0 4px 0 #cbd5e1; }
        .btn-next { background: var(--kart-green); color: white; box-shadow: 0 4px 0 #16a34a; }

        .kart-input, .kart-select {
            width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 12px;
            font-size: 15px; font-weight: bold; outline: none; background: #fff; margin-bottom: 8px; color: black;
        }
        .manager-mode .kart-input { border-color: var(--manager-gold); background: #222; color: white; }

        .input-label { font-size: 11px; font-weight: 800; color: #64748b; margin-bottom: 4px; display: block; padding-left: 4px; text-align: left; }

        .terms-box { background: #f8f9fa; border: 1px solid #e2e8f0; padding: 10px; border-radius: 10px; margin-bottom: 8px; color: black; }
        .terms-detail { display: none; font-size: 10px; color: #666; margin-top: 5px; line-height: 1.4; border-top: 1px dashed #ccc; padding-top: 5px; text-align: left; }
        .terms-detail.show { display: block; }
        .view-link { font-size: 10px; color: var(--kart-blue); text-decoration: underline; cursor: pointer; }

        .impact-badge {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #000; font-weight: 900; padding: 2px 10px; border-radius: 6px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1); font-size: 9px; display: inline-block;
        }

        .global-footer {
            position: absolute; bottom: 15px; left: 0; right: 0;
            text-align: center; z-index: 100; pointer-events: none;
        }
        .copyright-text {
            font-size: 9px; color: #64748b; font-weight: 700; opacity: 0.7;
            letter-spacing: -0.2px; text-shadow: 1px 1px 0px rgba(255,255,255,0.5);
        }

        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .hidden { display: none !important; }

        .entry-no-badge {
            background: #000; color: #fff; font-family: 'Fredoka', sans-serif;
            font-weight: 900; padding: 4px 10px; border-radius: 8px; border: 2px solid #fff;
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3); z-index: 20;
        }
    </style>
</head>
<body>

<div class="kart-frame">
    <div class="road-bg"></div>

    <div class="hud">
        <div class="flex items-center gap-2">
            <span class="text-xs font-bold text-gray-100">LAP</span>
            <span class="lap-badge" id="stepIndicator">START</span>
        </div>
        <div class="flex items-center gap-2">
            <i class="ph-fill ph-coin text-yellow-300"></i>
            <span class="font-black text-white" id="scoreDisplay">000</span>
        </div>
    </div>

    <!-- 1. Intro Screen -->
    <div id="screen-intro" class="scene flex justify-center fade-in">
        <div class="text-center">
            <div class="relative mb-6">
                <i class="ph-duotone ph-steering-wheel text-8xl text-white drop-shadow-lg"></i>
            </div>
            <h1 class="intro-logo">SUPER<br>SALES KART</h1>
            <div class="logo-sub">ë³´í—˜ì˜ì—…ì¸ ë‚´ ê°€ì¹˜ ì¸¡ì •í•˜ê¸°</div>
        </div>
        <button class="kart-btn" onclick="startRace()">RACE START!</button>
    </div>

    <!-- 2. Dynamic Question Screen -->
    <div id="screen-q" class="scene hidden fade-in">
        <div class="glass-panel" id="main-panel">
            <div class="q-header">
                <span class="q-tag" id="q-category">DRIVING</span>
                <span id="manager-badge" class="manager-badge hidden">MANAGER MODE</span>
                <span class="text-xs text-gray-400 font-bold" id="q-progress">1 / 13</span>
            </div>
            <p class="q-text" id="q-desc">...</p>
            <div id="area-choice" class="flex flex-col"></div>
            <div id="area-input" class="flex flex-col"></div>
        </div>
        <div class="flex gap-3 w-full max-w-[400px] mt-2 px-4">
            <button class="nav-btn btn-back w-1/3" onclick="prevStep()">BACK</button>
            <button class="nav-btn btn-next w-2/3 hidden" id="btn-next-manual" onclick="handleNext()">NEXT â–¶</button>
        </div>
    </div>

    <!-- 3. Result Screen -->
    <div id="screen-result" class="scene hidden fade-in" style="padding-top:40px;">
        <div class="glass-panel text-center relative border-blue-200 border-4">
            <div class="entry-no-badge" id="res-entry-box" style="display:none;">PLAYER NO.<span id="res-entry-no">---</span></div>
            <div class="w-20 h-20 bg-white rounded-full mx-auto -mt-16 border-4 border-yellow-400 flex items-center justify-center text-4xl shadow-lg mb-4">ğŸ†</div>
            <h2 class="text-2xl font-black text-gray-800 mb-1 text-center">FINISH!</h2>
            <p class="text-xs text-gray-500 font-bold mb-6 uppercase tracking-widest text-center font-bold">Course Clear â€¢ New Record</p>

            <div class="bg-gradient-to-br from-blue-50 to-sky-50 p-4 rounded-2xl border-2 border-white shadow-inner text-center mb-6">
                <p class="text-[10px] font-bold text-blue-500 tracking-widest mb-1 text-center uppercase font-bold">Estimated Bounty</p>
                <div class="text-3xl font-black text-gray-800 text-center"><span id="finalPrice">0</span> <span class="text-lg text-gray-500 font-bold">ë§Œì›</span></div>
                <p class="text-[10px] font-bold text-gray-400 mt-1 text-center font-bold">ê¸°ì¤€ ê¸ˆì•¡ ëŒ€ë¹„ <span class="text-red-500" id="finalPct">0</span>% ì¸ì •</p>
            </div>

            <div style="height: 180px; width: 100%; margin-bottom: 20px;"><canvas id="radarChart"></canvas></div>

            <div class="bg-blue-900/5 border-2 border-blue-100 p-4 rounded-3xl mb-6 text-center font-bold">
                <h3 class="text-[11px] font-black text-blue-800 mb-4 flex items-center justify-center gap-1 tracking-wider uppercase">
                    <i class="ph-fill ph-rocket-launch text-blue-500"></i> Potential Earnings
                </h3>
                <div id="commission-container" class="grid grid-cols-2 gap-3 px-1"></div>
                <div class="mt-4 px-1 text-center font-bold">
                    <p class="text-[13px] text-blue-700 font-black mb-1 leading-snug bg-blue-50 py-2 rounded-xl border border-blue-100">
                        â€» ìœ„ ìˆ˜ì¹˜ëŠ” ê¸°ì…í•˜ì‹  í‰ê·  ì›”ë‚©ë³´í—˜ë£Œ <span id="resRefPremium" class="underline decoration-2 font-black text-red-600 px-1 text-[15px]">0</span>ë§Œì›ì„<br>ê¸°ì¤€ìœ¼ë¡œ ì‚°ì¶œëœ ìˆ˜ì¹˜ì…ë‹ˆë‹¤.
                    </p>
                    <p class="text-[8px] text-gray-400 leading-tight mt-2">
                        * ì˜ˆìƒ ìˆ˜ìˆ˜ë£Œìœ¨ì€ ë§¤ì›” ì‹œìƒì˜ í‰ê· ì¹˜ê°€ í¬í•¨ëœ ì˜ˆìƒì¹˜ì´ë©°,<br>ì‹¤ì œ ìˆ˜ìˆ˜ë£ŒëŠ” ê³„ì•½ ì¡°ê±´ ë° ìƒí’ˆêµ°ì— ë”°ë¼ ì°¨ì´ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                </div>
            </div>
            
            <div class="bg-gray-800 p-4 rounded-2xl text-[11px] text-gray-300 leading-relaxed text-left mb-6 font-bold">
                <strong class="text-yellow-400 block mb-1 text-xs font-black font-bold">ğŸ“¢ PIT CREW'S ADVICE:</strong>
                <span id="aiAdvice">ë°ì´í„° ë¶„ì„ ì¤‘...</span>
            </div>

            <div class="pt-2 text-center opacity-60 border-t border-gray-100">
                <p class="text-[8px] text-gray-400 text-center font-bold">Copyright Â© 2026 Partnerscompany,co.,ltd. All rights reserved.</p>
            </div>
        </div>
        <button class="kart-btn w-full text-lg mt-4 mb-10" onclick="location.reload()">ë‹¤ì‹œ í•˜ê¸°</button>
    </div>

    <!-- Global Footer -->
    <div class="global-footer" id="global-footer">
        <p class="copyright-text">Copyright Â© 2026 Partnerscompany,co.,ltd. All rights reserved.</p>
    </div>
</div>

<script>
    const BACKEND_URL = 'https://fa-cal.onrender.com/api/submit';

    const regionData = {
        "ì„œìš¸": ["ê°•ë‚¨êµ¬", "ê°•ë™êµ¬", "ê°•ë¶êµ¬", "ê°•ì„œêµ¬", "ê´€ì•…êµ¬", "ê´‘ì§„êµ¬", "êµ¬ë¡œêµ¬", "ê¸ˆì²œêµ¬", "ë…¸ì›êµ¬", "ë„ë´‰êµ¬", "ë™ëŒ€ë¬¸êµ¬", "ë™ì‘êµ¬", "ë§ˆí¬êµ¬", "ì„œëŒ€ë¬¸êµ¬", "ì„œì´ˆêµ¬", "ì„±ë™êµ¬", "ì„±ë¶êµ¬", "ì†¡íŒŒêµ¬", "ì–‘ì²œêµ¬", "ì˜ë“±í¬êµ¬", "ìš©ì‚°êµ¬", "ì€í‰êµ¬", "ì¢…ë¡œêµ¬", "ì¤‘êµ¬", "ì¤‘ë‘êµ¬"],
        "ê²½ê¸°": ["ìˆ˜ì›ì‹œ", "ê³ ì–‘ì‹œ", "ìš©ì¸ì‹œ", "ì„±ë‚¨ì‹œ", "ë¶€ì²œì‹œ", "í™”ì„±ì‹œ", "ì•ˆì‚°ì‹œ", "ë‚¨ì–‘ì£¼ì‹œ", "ì•ˆì–‘ì‹œ", "í‰íƒì‹œ", "ì‹œí¥ì‹œ", "íŒŒì£¼ì‹œ", "ì˜ì •ë¶€ì‹œ", "ê¹€í¬ì‹œ", "ê´‘ì£¼ì‹œ", "ê´‘ëª…ì‹œ", "êµ°í¬ì‹œ", "í•˜ë‚¨ì‹œ", "ì˜¤ì‚°ì‹œ", "ì´ì²œì‹œ", "ì•ˆì„±ì‹œ", "ì˜ì™•ì‹œ", "ì–‘ì£¼ì‹œ", "êµ¬ë¦¬ì‹œ", "í¬ì²œì‹œ", "ë™ë‘ì²œì‹œ", "ê³¼ì²œì‹œ", "ê°€í‰êµ°", "ì–‘í‰êµ°", "ì—¬ì£¼ì‹œ", "ì—°ì²œêµ°"],
        "ì¸ì²œ": ["ê³„ì–‘êµ¬", "ë‚¨ë™êµ¬", "ë™êµ¬", "ë¯¸ì¶”í™€êµ¬", "ë¶€í‰êµ¬", "ì„œêµ¬", "ì—°ìˆ˜êµ¬", "ì¤‘êµ¬", "ê°•í™”êµ°", "ì˜¹ì§„êµ°"],
        "ëŒ€ì „": ["ëŒ€ë•êµ¬", "ë™êµ¬", "ì„œêµ¬", "ìœ ì„±êµ¬", "ì¤‘êµ¬"],
        "ë¶€ì‚°": ["ê°•ì„œêµ¬", "ê¸ˆì •êµ¬", "ë‚¨êµ¬", "ë™êµ¬", "ë™ë˜êµ¬", "ë¶€ì‚°ì§„êµ¬", "ë¶êµ¬", "ì‚¬ìƒêµ¬", "ì‚¬í•˜êµ¬", "ì„œêµ¬", "ìˆ˜ì˜êµ¬", "ì—°ì œêµ¬", "ì˜ë„êµ¬", "ì¤‘êµ¬", "í•´ìš´ëŒ€êµ¬", "ê¸°ì¥êµ°"],
        "ëŒ€êµ¬": ["ë‚¨êµ¬", "ë‹¬ì„œêµ¬", "ë™êµ¬", "ë¶êµ¬", "ì„œêµ¬", "ìˆ˜ì„±êµ¬", "ì¤‘êµ¬", "ë‹¬ì„±êµ°"]
    };

    const questions = [
        { id: 'affiliation', title: 'í˜„ì¬ ì†Œì†', text: 'í˜„ì¬ ì–´ë–¤ í™˜ê²½ì—ì„œ í™œë™ ì¤‘ì´ì‹ ê°€ìš”?', type: 'choice', opts: ['ìƒëª…ë³´í—˜ (ì›ìˆ˜ì‚¬)', 'ì†í•´ë³´í—˜ (ì›ìˆ˜ì‚¬)', 'GA (ë²•ì¸ëŒ€ë¦¬ì )'] },
        { id: 'career', title: 'ê²½ë ¥', text: 'ë³´í—˜ ì˜ì—… ê²½ë ¥ì´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?', type: 'choice', opts: ['1ë…„ ë¯¸ë§Œ', '1~3ë…„', '3~5ë…„', '5~10ë…„', '10ë…„ ì´ìƒ'] },
        { id: 'income', title: 'ì—°ë´‰', text: 'ì‘ë…„ ì›ì²œì§•ìˆ˜ ì†Œë“ì„ ì…ë ¥í•˜ì„¸ìš”.', type: 'input', label: 'ë§Œì›', itype: 'number' },
        { id: 'perf', title: 'ê°œì¸ ì‹¤ì ', text: 'ë³¸ì¸ì˜ ì›” í‰ê·  ì‹¤ì ì„ ì…ë ¥í•˜ì„¸ìš”.', type: 'multi-input', inputs: [{id:'count', label:'ì›” í‰ê·  ê±´ìˆ˜', type:'number', p:'ê±´'}, {id:'premium', label:'ì›” í‰ê·  ë³´í—˜ë£Œ', type:'number', p:'ë§Œì›'}] },
        { id: 'qual', title: 'ìœ ì§€ìœ¨', text: 'ê³„ì•½ ìœ ì§€ìœ¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', type: 'multi-input', inputs: [{id:'p13', label:'13íšŒì°¨ (%)', type:'number', p:'%'}, {id:'p25', label:'25íšŒì°¨ (%)', type:'number', p:'%'}] },
        { id: 'port', title: 'ìƒí’ˆêµ°', text: 'ì£¼ë ¥ íŒë§¤ ìƒí’ˆêµ°ì€ ë¬´ì—‡ì¸ê°€ìš”?', type: 'choice', opts: ['ë³´ì¥ì„±', 'ì¢…ì‹ ë³´í—˜', 'ì—°ê¸ˆ/ì €ì¶•ì„±', 'ìë™ì°¨/ìš´ì „ì/í™”ì¬', 'ë³µí•©'] },
        { id: 'style', title: 'ì˜ì—…ë°©ì‹', text: 'ì£¼ë ¥ ì˜ì—… ë°©ì‹ì„ ì„ íƒí•˜ì„¸ìš”.', type: 'choice', opts: ['ê°œì²™ì˜ì—…', 'ì§€ì¸/ì†Œê°œì˜ì—…', 'DBì˜ì—…', 'ì´ê´€ê³ ê°ì˜ì—…', 'ê¸°íƒ€'] },
        { id: 'honor', title: 'ëª…ì˜ˆ ê¸°ë¡', text: 'ë³´ìœ í•˜ì‹  ì£¼ìš” ê¸°ë¡ì„ ì„ íƒí•˜ì„¸ìš”.\n(ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)', type: 'multi-choice', opts: ['ì—°ì† W ê¸°ë¡ ë³´ìœ ', 'MDRT ë‹¬ì„±', 'COT ë‹¬ì„±', 'TOT ë‹¬ì„±'] },
        { id: 'position_type', title: 'í¬ì§€ì…˜', text: 'í˜„ì¬ ë³¸ì¸ì˜ ì£¼ìš” í¬ì§€ì…˜ì€ ë¬´ì—‡ì¸ê°€ìš”?', type: 'choice', opts: ['ì¡°ì§ê´€ë¦¬ì', 'ëŒ€ë©´ì˜ì—…ì', 'TM ì˜ì—…ì', 'ê¸°íƒ€'] },
        { id: 'rank', title: 'ì§ê¸‰', text: 'í˜„ì¬ ì§ê¸‰ì„ ì„ íƒí•˜ì„¸ìš”.', type: 'choice', opts: ['íŒ€ì›', 'íŒ€ì¥', 'ì§€ì ì¥', 'ë³¸ë¶€ì¥/ì„ì›'] },
        { 
            id: 'team_info', 
            title: 'íŒ€ ì •ë³´', 
            text: 'ê´€ë¦¬í•˜ì‹œëŠ” íŒ€ì˜ ê·œëª¨ì™€ ì‹¤ì ì„ ì…ë ¥í•˜ì„¸ìš”.', 
            type: 'multi-input', 
            condition: (d) => ['íŒ€ì¥', 'ì§€ì ì¥', 'ë³¸ë¶€ì¥/ì„ì›'].includes(d.rank),
            inputs: [
                {id:'team_size', label:'íŒ€ ì „ì²´ ì¸ì›ìˆ˜', type:'number', p:'ëª…'},
                {id:'team_premium', label:'íŒ€ í•©ì‚° ì›”ë‚©ë³´í—˜ë£Œ', type:'number', p:'ë§Œì›'}
            ]
        },
        { 
            id: 'pay_preference', 
            title: 'ìˆ˜ìˆ˜ë£Œ ì„ í˜¸ë„', 
            text: 'ì„ í˜¸í•˜ëŠ” ìˆ˜ìˆ˜ë£Œ ì§€ê¸‰ ë°©ì‹ì„ ì„ íƒí•˜ì„¸ìš”.', 
            type: 'choice', 
            opts: ['ìµì›” ì„ ì§€ê¸‰ 2000% (ì´ 2000%)', 'ìµì›” 1000% + 13ì°¨ì›” 1500% (ì´ 2500%)'] 
        },
        { id: 'info_final', title: 'ì •ë³´ ì…ë ¥', text: 'ë¦¬í¬íŠ¸ ë°œê¸‰ì„ ìœ„í•œ ì •ë³´ ì…ë ¥', type: 'complex-form' }
    ];

    let userData = {};
    let currentIdx = -1;
    let radarChart = null;

    function showScreen(id) {
        document.querySelectorAll('.scene').forEach(el => el.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        if(id === 'screen-result') document.getElementById('global-footer').classList.add('hidden');
        else document.getElementById('global-footer').classList.remove('hidden');
    }

    function startRace() { currentIdx = 0; userData = {}; showScreen('screen-q'); renderQuestion(); }

    function renderQuestion() {
        while (currentIdx < questions.length) {
            const q = questions[currentIdx];
            if (q.condition && !q.condition(userData)) { currentIdx++; } else { break; }
        }
        if (currentIdx >= questions.length) { submitData(); return; }

        const q = questions[currentIdx];
        const lapNum = currentIdx + 1; 
        document.getElementById('stepIndicator').innerText = `LAP ${lapNum}`;
        document.getElementById('q-progress').innerText = `${lapNum} / ${questions.length}`;
        document.getElementById('q-desc').innerText = q.text;

        const panel = document.getElementById('main-panel');
        const mBadge = document.getElementById('manager-badge');
        const cArea = document.getElementById('area-choice'), iArea = document.getElementById('area-input');
        
        cArea.innerHTML = ''; iArea.innerHTML = '';
        cArea.classList.add('hidden'); iArea.classList.add('hidden');
        document.getElementById('btn-next-manual').classList.add('hidden');

        if(q.id === 'team_info') {
            panel.classList.add('manager-mode');
            mBadge.classList.remove('hidden');
        } else {
            panel.classList.remove('manager-mode');
            mBadge.classList.add('hidden');
        }

        if (q.type === 'choice') {
            cArea.classList.remove('hidden');
            q.opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = `option-btn ${userData[q.id] === opt ? 'selected' : ''}`;
                btn.innerText = opt;
                btn.onclick = () => { userData[q.id] = opt; currentIdx++; renderQuestion(); };
                cArea.appendChild(btn);
            });
        } else if (q.type === 'multi-choice') {
            cArea.classList.remove('hidden');
            document.getElementById('btn-next-manual').classList.remove('hidden');
            if(!userData[q.id]) userData[q.id] = [];
            q.opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = `option-btn ${userData[q.id].includes(opt) ? 'multi-selected' : ''}`;
                btn.innerText = opt;
                btn.onclick = () => {
                    if(userData[q.id].includes(opt)) userData[q.id] = userData[q.id].filter(i => i !== opt);
                    else userData[q.id].push(opt);
                    renderQuestion(); 
                };
                cArea.appendChild(btn);
            });
        } else {
            iArea.classList.remove('hidden');
            document.getElementById('btn-next-manual').classList.remove('hidden');
            if (q.type === 'multi-input') {
                q.inputs.forEach(inp => {
                    let icon = q.id === 'team_info' ? (inp.id === 'team_size' ? 'ğŸ‘¥ ' : 'ğŸ’° ') : '';
                    iArea.innerHTML += `<label class="input-label">${icon}${inp.label}</label><input type="${inp.type}" id="inp_${inp.id}" class="kart-input mb-4" placeholder="${inp.p} ì…ë ¥..." value="${userData[inp.id] || ''}">`;
                });
            } else if (q.type === 'input') {
                iArea.innerHTML = `<label class="input-label">${q.label}</label><input type="${q.itype || 'text'}" id="q-input" class="kart-input" placeholder="${q.label} ì…ë ¥..." value="${userData[q.id] || ''}">`;
            } else if (q.type === 'complex-form') {
                iArea.innerHTML = `
                    <label class="input-label">ì„±í•¨</label><input type="text" id="form_name" class="kart-input" placeholder="ì´ë¦„ ì…ë ¥">
                    <label class="input-label">ì—°ë½ì²˜</label>
                    <div class="flex gap-2"><input type="text" value="010" readonly class="kart-input w-24 bg-gray-100 text-gray-400 font-bold"><input type="tel" id="form_phone" class="kart-input flex-1" maxlength="8" placeholder="ë‚˜ë¨¸ì§€ 8ìë¦¬"></div>
                    <label class="input-label">ì—°ë ¹ëŒ€</label>
                    <select id="form_age" class="kart-select font-bold"><option value="">ì—°ë ¹ëŒ€ ì„ íƒ</option><option value="20ëŒ€">20ëŒ€</option><option value="30ëŒ€">30ëŒ€</option><option value="40ëŒ€">40ëŒ€</option><option value="50ëŒ€">50ëŒ€</option><option value="60ëŒ€ ì´ìƒ">60ëŒ€ ì´ìƒ</option></select>
                    <label class="input-label">ê±°ì£¼ ì§€ì—­</label>
                    <div class="flex gap-2"><select id="form_sido" class="kart-select flex-1 font-bold" onchange="updateSigungu()"><option value="">ì‹œ/ë„</option>${Object.keys(regionData).map(s => `<option value="${s}">${s}</option>`).join('')}</select><select id="form_sigungu" class="kart-select flex-1 font-bold"><option value="">ì‹œ/êµ°/êµ¬</option></select></div>
                    <div class="terms-box mt-2">
                        <div class="flex items-center justify-between font-bold text-[11px]"><label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" id="agree1" class="w-4 h-4 accent-blue-500"> [í•„ìˆ˜] ê°œì¸ì •ë³´ ìˆ˜ì§‘ ì´ìš© ë™ì˜</label><span class="view-link" onclick="toggleTerms('detail1')">ë³´ê¸°</span></div>
                        <div id="detail1" class="terms-detail text-xs">ë¶„ì„ ë° ì±„ìš© ì œì•ˆì„ ìœ„í•´ ì„±ëª…, ì—°ë½ì²˜, ì‹¤ì  ë“±ì„ ìˆ˜ì§‘í•˜ë©° ìˆ˜ì§‘ì¼ë¡œë¶€í„° 3ë…„ê°„ ë³´ìœ í•©ë‹ˆë‹¤. (ìœ„íƒ: (ì£¼)íŒŒíŠ¸ë„ˆìŠ¤ì»´í¼ë‹ˆ)</div>
                        <div class="flex items-center justify-between font-bold text-[11px] mt-2"><label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" id="agree2" class="w-4 h-4 accent-blue-500"> [í•„ìˆ˜] ì œ3ì ì •ë³´ ì œê³µ ë™ì˜</label><span class="view-link" onclick="toggleTerms('detail2')">ë³´ê¸°</span></div>
                        <div id="detail2" class="terms-detail text-xs">ìˆ˜ì§‘ëœ ë°ì´í„°ëŠ” ìµœì ì˜ ì±„ìš© ì œì•ˆì„ ìœ„í•´ ë©”íƒ€ë¦¬ì¹˜ íŒŒíŠ¸ë„ˆìŠ¤ì§€ì‚¬ ì‚°í•˜ ê´€ë¦¬ìì—ê²Œ ì œê³µë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
                    </div>
                `;
            }
        }
    }

    window.updateSigungu = () => {
        const sido = document.getElementById('form_sido').value;
        const sigungu = document.getElementById('form_sigungu');
        sigungu.innerHTML = '<option value="">ì‹œ/êµ°/êµ¬</option>';
        if(sido && regionData[sido]) { regionData[sido].forEach(s => { sigungu.innerHTML += `<option value="${s}">${s}</option>`; }); }
    };

    window.toggleTerms = (id) => document.getElementById(id).classList.toggle('show');

    function handleNext() {
        const q = questions[currentIdx];
        if (q.type === 'multi-choice') { if(!userData[q.id] || userData[q.id].length === 0) userData[q.id] = ["ê¸°ë¡ ì—†ìŒ"]; }
        else if (q.type === 'multi-input') {
            let valid = true;
            q.inputs.forEach(inp => {
                const val = document.getElementById(`inp_${inp.id}`).value;
                if(!val) valid = false; userData[inp.id] = val;
            });
            if(!valid) return alert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!');
        } else if (q.type === 'complex-form') {
            const name = document.getElementById('form_name').value, phone = document.getElementById('form_phone').value, age = document.getElementById('form_age').value, sido = document.getElementById('form_sido').value, sigungu = document.getElementById('form_sigungu').value, a1 = document.getElementById('agree1').checked, a2 = document.getElementById('agree2').checked;
            if(!name || phone.length < 8 || !age || !sido || !sigungu) return alert('ì •ë³´ë¥¼ ì •í™•íˆ ì…ë ¥í•´ ì£¼ì„¸ìš”!');
            if(!a1 || !a2) return alert('í•„ìˆ˜ ì•½ê´€ì— ë™ì˜í•˜ì…”ì•¼ ë¦¬í¬íŠ¸ í™•ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            userData.userName = name; userData.phone = `010-${phone.substring(0,4)}-${phone.substring(4,8)}`; userData.age = age; userData.region = `${sido} ${sigungu}`;
        }
        currentIdx++; renderQuestion();
    }

    function prevStep() { if(currentIdx > 0) { currentIdx--; renderQuestion(); } else { showScreen('screen-intro'); } }

    async function submitData() {
        let bonus = 0;
        const rk = userData.rank;
        if (rk === 'ë³¸ë¶€ì¥/ì„ì›') bonus += 5; else if (rk === 'ì§€ì ì¥') bonus += 3; else if (rk === 'íŒ€ì¥') bonus += 2;

        if (['íŒ€ì¥', 'ì§€ì ì¥', 'ë³¸ë¶€ì¥/ì„ì›'].includes(rk)) {
            const teamPrem = parseInt(userData.team_premium || 0), teamSize = parseInt(userData.team_size || 1);
            const teamProd = teamPrem / teamSize;
            let teamBonusBase = 0;
            if (teamPrem >= 5000) teamBonusBase = 30; else if (teamPrem >= 4000) teamBonusBase = 25; else if (teamPrem >= 3000) teamBonusBase = 20; else if (teamPrem >= 2000) teamBonusBase = 15; else if (teamPrem >= 1000) teamBonusBase = 10;
            let applyRate = 0.5;
            if (teamProd > 100) applyRate = 1.1; else if (teamProd > 60) applyRate = 1.0; else if (teamProd > 50) applyRate = 0.85; else if (teamProd > 40) applyRate = 0.6;
            bonus += (teamBonusBase * applyRate);
        }

        const cr = userData.career;
        if(cr === '1ë…„ ë¯¸ë§Œ') bonus -= 2; else if(['3~5ë…„','5~10ë…„','10ë…„ ì´ìƒ'].includes(cr)) bonus += (cr==='10ë…„ ì´ìƒ'?3:cr==='5~10ë…„'?2:1);
        
        const prem = parseInt(userData.premium || 0);
        if (prem >= 200) bonus += 20; else if (prem >= 150) bonus += 15; else if (prem >= 100) bonus += 10; else if (prem >= 90) bonus += 8; else if (prem >= 80) bonus += 7; else if (prem >= 70) bonus += 6; else if (prem >= 60) bonus += 5;

        const p13 = parseInt(userData.p13 || 0);
        if (p13 >= 95) bonus += 7; else if (p13 >= 90) bonus += 5; else if (p13 >= 85) bonus += 4; else if (p13 >= 80) bonus += 3;

        let baseValue = userData.career === '1ë…„ ë¯¸ë§Œ' ? 2000 : (parseInt(userData.income) || 5000) * 0.6;
        const finalVal = Math.round(baseValue * (1 + bonus / 100));

        showScreen('screen-result');
        document.getElementById('finalPrice').innerText = finalVal.toLocaleString();
        const refValue = (userData.career === '1ë…„ ë¯¸ë§Œ') ? 2000 : (parseInt(userData.income) || 5000);
        document.getElementById('finalPct').innerText = Math.round((finalVal / refValue) * 100);
        document.getElementById('resRefPremium').innerText = prem.toLocaleString();

        const commContainer = document.getElementById('commission-container');
        const payPref = userData.pay_preference;
        if (payPref.includes('2000%')) {
            commContainer.className = "flex flex-col items-center px-1";
            commContainer.innerHTML = `<div class="bg-white p-4 rounded-2xl border-2 border-blue-400 shadow-md w-full text-center font-bold"><div class="impact-badge" style="background: linear-gradient(135deg, #009dfd 0%, #00f2ea 100%); color: #fff; padding: 4px 15px; font-size: 11px;">ğŸ† ìµì›” ì„ ì§€ê¸‰ 2000% ì„ ìˆ˜ë‹¹</div><p class="text-[11px] text-gray-500 font-bold mt-3 mb-1">TOTAL CASH FLOW</p><p class="text-3xl font-black text-blue-600"><span>${(prem * 20).toLocaleString()}</span><span class="text-sm ml-1 font-bold">ë§Œì›</span></p></div>`;
        } else {
            commContainer.className = "grid grid-cols-2 gap-3 px-1";
            commContainer.innerHTML = `<div class="bg-white p-3 rounded-2xl border border-blue-200 shadow-sm flex flex-col justify-between min-h-[110px] font-bold"><div class="impact-badge" style="font-size: 8px;">ìµì›” ì„ ì§€ê¸‰ 1000%</div><p class="text-[10px] text-gray-500 font-bold mt-2 mb-1 leading-tight text-center font-bold">ìµì›” ì˜ˆìƒ ìˆ˜ë‹¹</p><p class="text-xl font-black text-blue-600 text-center"><span>${(prem * 10).toLocaleString()}</span><span class="text-xs ml-0.5 font-bold">ë§Œ</span></p></div><div class="bg-white p-3 rounded-2xl border border-red-200 shadow-sm flex flex-col justify-between min-h-[110px] font-bold"><div class="impact-badge" style="background: linear-gradient(135deg, #FF6B6B 0%, #EE0000 100%); color: #fff; font-size: 8px;">13ì°¨ì›” í›„ì§€ê¸‰ 1500%</div><p class="text-[10px] text-gray-500 font-bold mt-2 mb-1 leading-tight text-center font-bold">13ì°¨ì›” ì˜ˆìƒ ìˆ˜ë‹¹</p><p class="text-xl font-black text-red-600 text-center"><span>${(prem * 15).toLocaleString()}</span><span class="text-xs ml-0.5 font-bold">ë§Œ</span></p></div>`;
        }

        document.getElementById('aiAdvice').innerText = `${userData.userName}ë‹˜, ë°ì´í„° ê¸°ë°˜ ë¶„ì„ ê²°ê³¼ ì´ ${bonus}%ì˜ ê°€ì¤‘ì¹˜ê°€ ë‹¹ì‹ ì˜ ì»¤ë¦¬ì–´ë¥¼ ì¦ëª…í•©ë‹ˆë‹¤. íŠ¹íˆ ìƒì‚°ì„± ê³„ìˆ˜ê°€ ë§¤ìš° íƒì›”í•©ë‹ˆë‹¤!`;
        renderRadarChart([Math.min(10, prem/15+2), 8, Math.min(10, p13/10), 7, Math.min(10, (parseInt(userData.team_size)||0)/2+3)]);

        try {
            const res = await fetch(BACKEND_URL, {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ...userData, final_bounty: finalVal, timestamp: new Date().toLocaleString() })
            });
            const resData = await res.json();
            if(resData.success) {
                document.getElementById('res-entry-box').style.display = 'block';
                document.getElementById('res-entry-no').innerText = resData.entryNo.toString().padStart(3, '0');
                document.getElementById('scoreDisplay').innerText = resData.entryNo;
            }
        } catch(e) { console.error(e); }
    }

    function renderRadarChart(data) {
        const ctx = document.getElementById('radarChart').getContext('2d');
        if(radarChart) radarChart.destroy();
        radarChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['ìƒì‚°ì„±', 'íš¨ìœ¨ì„±', 'ìœ ì§€ìœ¨', 'ì „ë¬¸ì„±', 'ë¦¬ë”ì‹­'],
                datasets: [{ data: data, backgroundColor: 'rgba(0, 157, 253, 0.2)', borderColor: '#009dfd', borderWidth: 2, pointBackgroundColor: '#fff' }]
            },
            options: { scales: { r: { min: 0, max: 10, ticks: { display: false } } }, plugins: { legend: { display: false } }, maintainAspectRatio: false }
        });
    }
</script>
</body>
</html>
