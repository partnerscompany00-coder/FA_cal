<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SUPER SALES KART : PROFESSIONAL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --kart-blue: #009dfd;
            --kart-red: #ea0012;
            --kart-yellow: #fff300;
            --kart-green: #37d300;
            --kart-dark: #121212;
            --glass-bg: rgba(255, 255, 255, 0.9);
            --glass-border: rgba(255, 255, 255, 0.4);
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #2c3e50;
            color: #333;
            overflow-x: hidden;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0; overscroll-behavior: none;
        }

        .kart-frame {
            width: 100%; max-width: 480px; height: 100dvh; max-height: 900px;
            background: linear-gradient(to bottom, #87CEEB 0%, #E0F7FA 100%);
            position: relative; display: flex; flex-direction: column;
            box-shadow: 0 30px 60px rgba(0,0,0,0.5); overflow: hidden;
            border: 4px solid #fff; border-radius: 24px;
        }

        .road-bg {
            position: absolute; bottom: -20%; left: -50%; width: 200%; height: 60%;
            background-color: #444;
            background-image: 
                linear-gradient(90deg, transparent 49%, #fff 50%, transparent 51%),
                repeating-linear-gradient(0deg, transparent, transparent 20px, rgba(255,255,255,0.1) 21px, rgba(255,255,255,0.1) 40px);
            transform: perspective(500px) rotateX(60deg);
            animation: roadMove 1s linear infinite; pointer-events: none; z-index: 0; opacity: 0.6;
        }
        @keyframes roadMove { from { background-position: 0 0; } to { background-position: 0 80px; } }

        .hud {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px; z-index: 50; background: rgba(0, 157, 253, 0.4);
            backdrop-filter: blur(10px); border-bottom: 2px solid rgba(255,255,255,0.5); color: white;
        }
        .lap-badge { background: var(--kart-red); padding: 2px 12px; border-radius: 20px; font-weight: 700; box-shadow: 0 4px 0 #990000; }

        .scene {
            flex: 1; position: relative; z-index: 10; display: flex; flex-direction: column;
            align-items: center; padding: 20px; padding-bottom: 80px; overflow-y: auto; width: 100%;
        }
        .scene::-webkit-scrollbar { display: none; }
        .center-scene { justify-content: center; }

        .intro-logo {
            font-family: 'Fredoka', sans-serif; font-size: 44px; line-height: 1.1; font-weight: 700;
            color: #fff; text-align: center; text-shadow: 0 4px 0 var(--kart-blue), 0 8px 0 var(--kart-dark);
            transform: skewY(-5deg) rotate(-2deg); margin-bottom: 30px;
        }
        .logo-sub {
            background: var(--kart-yellow); color: #000; padding: 8px 24px; border-radius: 50px;
            font-weight: 900; display: inline-block; box-shadow: 0 5px 0 #e6a700; transform: skewY(-5deg);
            margin-bottom: 50px; font-size: 15px;
        }
        
        .kart-btn {
            background: linear-gradient(to bottom, #ff5e3a 0%, #ff2a00 100%);
            border: 2px solid rgba(255,255,255,0.5); border-radius: 50px;
            color: white; font-size: 24px; font-weight: 900; padding: 16px 60px;
            box-shadow: 0 6px 0 #cc2200, 0 15px 30px rgba(0,0,0,0.4);
            transition: transform 0.1s, box-shadow 0.1s;
            cursor: pointer;
        }
        .kart-btn:active { transform: translateY(6px); box-shadow: none; }

        .glass-panel {
            background: var(--glass-bg); border-radius: 24px; padding: 24px; width: 100%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 20px;
            backdrop-filter: blur(10px); border: 1px solid var(--glass-border);
        }
        .q-tag { background: var(--kart-blue); color: white; padding: 3px 12px; border-radius: 12px; font-size: 11px; font-weight: 800; }
        .q-text { font-size: 20px; font-weight: 800; color: #2d3748; text-align: center; margin-bottom: 24px; line-height: 1.4; }

        .racer-grid { display: grid; grid-template-columns: 1fr; gap: 10px; width: 100%; }
        .racer-card {
            background: white; border-radius: 16px; padding: 12px;
            display: flex; align-items: center; cursor: pointer;
            border: 2px solid #eee; box-shadow: 0 4px 0 #ddd;
            transition: all 0.2s;
        }
        .racer-card:hover { background: #fff9c4; border-color: var(--kart-yellow); transform: translateY(-2px); }
        .racer-img-box {
            width: 48px; height: 48px; border-radius: 50%; background: #eee; margin-right: 15px;
            display: flex; align-items: center; justify-content: center; font-size: 24px; border: 2px solid #000;
        }
        .racer-info h4 { font-weight: 800; color: #333; font-size: 15px; }
        .racer-info p { font-size: 11px; color: #777; }

        .option-btn {
            display: block; width: 100%; text-align: left;
            background: white; border: 2px solid #eee;
            padding: 14px; margin-bottom: 10px;
            font-size: 15px; font-weight: 700; border-radius: 12px;
            box-shadow: 0 4px 0 #ddd; transition: 0.1s;
            position: relative;
        }
        .option-btn.selected { background: #fff9c4; border-color: var(--kart-yellow); box-shadow: 0 4px 0 #fbc02d; }
        .option-btn.selected::after { content: 'ğŸ'; position: absolute; right: 15px; top: 50%; transform: translateY(-50%); }
        .option-btn:active { transform: translateY(4px); box-shadow: none; }

        .nav-btn {
            flex: 1; padding: 14px; text-align: center; border-radius: 16px;
            font-weight: 800; font-size: 16px; transition: transform 0.1s;
        }
        .btn-back { background: #f1f5f9; color: #64748b; box-shadow: 0 4px 0 #cbd5e1; }
        .btn-next { background: var(--kart-green); color: white; box-shadow: 0 4px 0 #16a34a; }

        .kart-input {
            width: 100%; padding: 16px; border: 2px solid #e2e8f0; border-radius: 16px;
            font-size: 18px; font-weight: bold; text-align: center; outline: none; background: #fff;
        }
        .input-label { font-size: 13px; font-weight: 700; color: #555; margin-bottom: 6px; display: block; text-align: center; }

        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .hidden { display: none !important; }

        .entry-no-badge {
            background: #000; color: #fff; font-family: 'Fredoka', sans-serif;
            font-weight: 900; padding: 4px 10px; border-radius: 8px; border: 2px solid #fff;
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3); z-index: 20;
        }
    </style>
</head>
<body>

<div class="kart-frame">
    <div class="road-bg"></div>

    <!-- HUD -->
    <div class="hud">
        <div class="flex items-center gap-2">
            <span class="text-xs font-bold text-gray-100">LAP</span>
            <span class="lap-badge" id="stepIndicator">START</span>
        </div>
        <div class="flex items-center gap-2">
            <i class="ph-fill ph-coin text-yellow-300"></i>
            <span class="font-black text-white" id="scoreDisplay">000</span>
        </div>
    </div>

    <!-- 1. Intro Screen -->
    <div id="screen-intro" class="scene center-scene fade-in">
        <div class="text-center">
            <div class="relative mb-6">
                <i class="ph-duotone ph-steering-wheel text-8xl text-white drop-shadow-lg"></i>
            </div>
            <h1 class="intro-logo">SUPER<br>SALES KART</h1>
            <div class="logo-sub">ë³´í—˜ì˜ì—…ì ë‚´ ê°€ì¹˜ ì¸¡ì •í•˜ê¸°</div>
        </div>
        <button class="kart-btn" onclick="goToRacerSelect()">ì‹œì‘í•˜ê¸°</button>
    </div>

    <!-- 2. Racer Select -->
    <div id="screen-racer" class="scene hidden fade-in">
        <div class="glass-panel">
            <div class="q-header">
                <span class="q-tag">SELECT PLAYER</span>
                <span class="text-xs text-gray-400 font-bold" id="racer-progress">1 / 18</span>
            </div>
            <p class="q-text">ë‚˜ì˜ ì˜ì—… ìŠ¤íƒ€ì¼ê³¼<br>ê°€ì¥ ë‹®ì€ ìºë¦­í„°ëŠ”?</p>
            <div id="racer-list" class="racer-grid"></div>
        </div>
    </div>

    <!-- 3. Dynamic Questions -->
    <div id="screen-q" class="scene hidden fade-in">
        <div class="glass-panel">
            <div class="q-header">
                <span class="q-tag" id="q-category">DRIVING</span>
                <span class="text-xs text-gray-400 font-bold" id="q-progress">2 / 18</span>
            </div>
            <p class="q-text" id="q-desc">...</p>
            <div id="area-choice" class="flex flex-col"></div>
            <div id="area-input" class="hidden"></div>
        </div>
        <div class="flex gap-3 w-full max-w-[400px] mt-2">
            <button class="nav-btn btn-back w-1/3" onclick="prevStep()">BACK</button>
            <button class="nav-btn btn-next w-2/3" id="btn-next-manual" onclick="handleNext()">NEXT â–¶</button>
        </div>
    </div>

    <!-- 4. Result Screen -->
    <div id="screen-result" class="scene hidden fade-in" style="padding-top:40px;">
        <div class="glass-panel text-center relative">
            <div class="entry-no-badge" id="res-entry-box" style="display:none;">
                PLAYER NO.<span id="res-entry-no">---</span>
            </div>

            <div class="w-20 h-20 bg-white rounded-full mx-auto -mt-16 border-4 border-yellow-400 flex items-center justify-center text-4xl shadow-lg mb-4">
                <span id="res-racer-icon">ğŸ†</span>
            </div>
            <h2 class="text-2xl font-black text-gray-800 mb-1">FINISH!</h2>
            <p class="text-xs text-gray-500 font-bold mb-6 uppercase tracking-widest text-center">Course Clear â€¢ New Record</p>

            <div class="bg-gradient-to-br from-blue-50 to-sky-50 p-4 rounded-2xl border-2 border-white shadow-inner text-center mb-6">
                <p class="text-[10px] font-bold text-blue-500 tracking-widest mb-1 text-center">ESTIMATED BOUNTY</p>
                <div class="text-3xl font-black text-gray-800 text-center">
                    <span id="finalPrice">0</span> <span class="text-lg text-gray-500">ë§Œì›</span>
                </div>
                <p class="text-xs font-bold text-gray-400 mt-1 text-center">ì—°ë´‰ ëŒ€ë¹„ <span class="text-red-500" id="finalPct">0</span>% ì¸ì •</p>
            </div>

            <div style="height: 200px; width: 100%; margin-bottom: 20px;">
                <canvas id="radarChart"></canvas>
            </div>
            
            <div class="bg-gray-800 p-4 rounded-2xl text-[11px] text-gray-300 leading-relaxed text-left">
                <strong class="text-yellow-400 block mb-1 text-xs">ğŸ“¢ PIT CREW'S ADVICE:</strong>
                <span id="aiAdvice">ë°ì´í„° ë¶„ì„ ì¤‘...</span>
            </div>
        </div>
        <button class="kart-btn w-full text-lg mt-4" onclick="location.reload()">ë‹¤ì‹œ í•˜ê¸°</button>
    </div>
</div>

<script>
    const BACKEND_URL = 'https://fa-cal.onrender.com/api/submit';

    const racerList = [
        { id: 'mario', name: 'ë§ˆë¦¬ì˜¤ (ë¦¬ë”í˜•)', desc: 'íŒ€ì„ ì´ë„ëŠ” íƒì›”í•œ ì¡°ì§ ê´€ë¦¬ì', icon: 'ğŸ§¢' },
        { id: 'luigi', name: 'ë£¨ì´ì§€ (ë°¸ëŸ°ìŠ¤)', desc: 'ê¸°ë³¸ê¸°ê°€ íƒ„íƒ„í•œ íŒ”ë°©ë¯¸ì¸ ì˜ì—…ì', icon: 'ğŸŸ¢' },
        { id: 'bowser', name: 'ì¿ í¼ (íŒŒì›Œí˜•)', desc: 'í´ë¡œì§• ë§ˆìŠ¤í„° (ê²°ì •ë ¥)', icon: 'ğŸ”¥' },
        { id: 'yoshi', name: 'ìš”ì‹œ (ìŠ¤í”¼ë“œ)', desc: 'ì „í™” ì—°ê²°ì˜ ì‹ , TA ê³ ìˆ˜', icon: 'ğŸ¥š' },
        { id: 'toad', name: 'í‚¤ë…¸í”¼ì˜¤ (ì„œí¬íŠ¸)', desc: 'ì¡°ì§ì˜ í•µì‹¬ ì¡°ë ¥ì', icon: 'ğŸ„' }
    ];

    const questions = [
        { id: 'rank', title: 'ì§ê¸‰', text: 'í˜„ì¬ ì§ê¸‰ì„ ì„ íƒí•˜ì„¸ìš”.', type: 'choice', opts: ['íŒ€ì›', 'íŒ€ì¥', 'ì§€ì ì¥', 'ë³¸ë¶€ì¥'] },
        { id: 'team_size', title: 'ì¡°ì§ ê·œëª¨', text: 'ì‚°í•˜ íŒ€ì›ì€ ëª‡ ëª…ì¸ê°€ìš”?', type: 'input', label: 'ì¸ì›(ëª…)', itype: 'number' },
        { id: 'recruit_avg', title: 'ë¦¬í¬ë£¨íŒ…', text: 'ì—°ê°„ ë„ì… ì¸ì›ì€ ëª‡ ëª…ì¸ê°€ìš”?', type: 'input', label: 'ëª…', itype: 'number' },
        { id: 'license', title: 'ìê²©', text: 'ë³´ìœ  ìê²© ì¢…ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.', type: 'choice', opts: ['ê¸°ë³¸ ìê²©', '+ ë³€ì•¡ ë³´í—˜ ìê²©', '+ ê¸ˆìœµ ì „ë¬¸ ìê²©'] },
        { id: 'career', title: 'ê²½ë ¥', text: 'ë³´í—˜ ì˜ì—… ê²½ë ¥ì´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?', type: 'choice', opts: ['1ë…„ ë¯¸ë§Œ', '1~3ë…„', '3~5ë…„', '5~10ë…„', '10ë…„ ì´ìƒ'] },
        { id: 'income', title: 'ì—°ë´‰', text: 'ì‘ë…„ ì›ì²œì§•ìˆ˜ ì†Œë“ì„ ì…ë ¥í•˜ì„¸ìš”.', type: 'input', label: 'ë§Œì›', itype: 'number' },
        { id: 'history', title: 'ì´ì§', text: 'ìµœê·¼ 3ë…„ ë‚´ ë³´í—˜ì‚¬ ì´ì§ íšŸìˆ˜ëŠ”?', type: 'choice', opts: ['ì—†ìŒ', '1íšŒ', '2íšŒ', '3íšŒ ì´ìƒ'] },
        { id: 'style', title: 'ë°©ì‹', text: 'ì£¼ë ¥ ì˜ì—… ë°©ì‹ì„ ì„ íƒí•˜ì„¸ìš”.', type: 'choice', opts: ['ê°œì²™ì˜ì—…', 'ì§€ì¸/ì†Œê°œì˜ì—…', 'DBì˜ì—…', 'ì´ê´€ê³ ê°ì˜ì—…', 'ê¸°íƒ€'] },
        { id: 'client', title: 'ê³ ê°', text: 'ì£¼ë ¥ ê³ ê°ì¸µì€ ëˆ„êµ¬ì¸ê°€ìš”?', type: 'choice', opts: ['ì§ì¥ì¸', 'ì£¼ë¶€', 'ìì˜ì—…ì', 'ë²•ì¸/ì „ë¬¸ì§', 'ê¸°íƒ€'] },
        { id: 'port', title: 'ìƒí’ˆ', text: 'ì£¼ë ¥ íŒë§¤ ìƒí’ˆêµ°ì€?', type: 'choice', opts: ['ë³´ì¥ì„±', 'ì €ì¶•ì„±', 'ìë™ì°¨/í™”ì¬', 'ë³µí•©'] },
        { id: 'w', title: 'ì—°ì†ì˜ì—…', text: 'ì—°ì† ì²­ì•½(W) ê¸°ë¡ì„ ì„ íƒí•˜ì„¸ìš”.', type: 'choice', opts: ['ì—†ìŒ', '1W 20ì£¼', '2W 20ì£¼', '3W 50ì£¼'] },
        { id: 'perf', title: 'í‰ê·  ì‹¤ì ', text: 'ì›” í‰ê·  ì‹¤ì  ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', type: 'multi-input', inputs: [{id:'count', label:'ì›” ê±´ìˆ˜', type:'number', p:'ê±´'}, {id:'premium', label:'ì›” ë³´í—˜ë£Œ', type:'number', p:'ë§Œì›'}] },
        { id: 'mdrt', title: 'MDRT', text: 'MDRT ë‹¬ì„± ê¸°ë¡ì„ ì„ íƒí•˜ì„¸ìš”.', type: 'choice', opts: ['ì—†ìŒ', 'MDRT', 'COT', 'TOT'] },
        { id: 'mdrt_cnt', title: 'MDRT íšŸìˆ˜', text: 'MDRT ë‹¬ì„± íšŸìˆ˜ëŠ”?', type: 'choice', opts: ['1íšŒ', '2íšŒ', '3~4íšŒ', '5íšŒ ì´ìƒ'], condition: (d) => d.mdrt !== 'ì—†ìŒ' },
        { id: 'qual', title: 'ìœ ì§€ìœ¨', text: 'ê³„ì•½ ìœ ì§€ìœ¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', type: 'multi-input', inputs: [{id:'p13', label:'13íšŒì°¨ (%)', type:'number', p:'%'}, {id:'p25', label:'25íšŒì°¨ (%)', type:'number', p:'%'}] },
        { id: 'needs', title: 'í˜„ì¬ ë¶ˆë§Œ', text: 'í˜„ì¬ ì¡°ì§ì— ë¶ˆë§Œì´ ìˆë‹¤ë©´ ì–´ë–¤ ì ì¸ê°€ìš”?', type: 'choice', opts: ['DB ì§€ì› ë¶€ì¡±', 'ìˆ˜ìˆ˜ë£Œ/ë³´ìƒ ì²´ê³„', 'êµìœ¡ ì‹œìŠ¤í…œ ë¶€ì¬', 'ì¡°ì§ ë¬¸í™”/ë¹„ì „', 'ë¶ˆë§Œ ì—†ìŒ'] },
        { id: 'info', title: 'ê¸°ë³¸ ì •ë³´', text: 'ë¦¬í¬íŠ¸ ë°œê¸‰ì„ ìœ„í•œ ì •ë³´ ì…ë ¥', type: 'multi-input', inputs: [{id:'userName', label:'ì´ë¦„', type:'text', p:'ì„±í•¨'}, {id:'region', label:'ì§€ì—­', type:'text', p:'í™œë™ì§€ì—­'}] },
        { id: 'gender', title: 'ì„±ë³„', text: 'ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', type: 'choice', opts: ['ë‚¨ì„±', 'ì—¬ì„±'] },
        { id: 'phone', title: 'ì—°ë½ì²˜', text: 'ê²°ê³¼ ìˆ˜ì‹ ì„ ìœ„í•´ ì—°ë½ì²˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', type: 'phone' }
    ];

    let userData = {};
    let currentIdx = -1;
    let radarChart = null;

    function showScreen(id) {
        document.querySelectorAll('.scene').forEach(el => el.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    function goToRacerSelect() {
        showScreen('screen-racer');
        const list = document.getElementById('racer-list');
        list.innerHTML = '';
        racerList.forEach(r => {
            const el = document.createElement('div');
            el.className = 'racer-card';
            el.innerHTML = `<div class="racer-img-box">${r.icon}</div>
                            <div class="flex-1 text-left">
                                <h4 class="font-bold text-sm">${r.name}</h4>
                                <p class="text-[10px] text-gray-500">${r.desc}</p>
                            </div>`;
            el.onclick = () => { userData['racer'] = r; startRace(); };
            list.appendChild(el);
        });
    }

    function startRace() {
        currentIdx = 0;
        showScreen('screen-q');
        renderQuestion();
    }

    function renderQuestion() {
        while (currentIdx < questions.length) {
            const q = questions[currentIdx];
            if (q.condition && !q.condition(userData)) { currentIdx++; } else { break; }
        }
        if (currentIdx >= questions.length) { submitData(); return; }

        const q = questions[currentIdx];
        const lapNum = currentIdx + 2; 
        document.getElementById('stepIndicator').innerText = `LAP ${lapNum}`;
        document.getElementById('q-progress').innerText = `${lapNum} / 21`;
        document.getElementById('q-desc').innerText = q.text;

        const cArea = document.getElementById('area-choice'), iArea = document.getElementById('area-input');
        cArea.innerHTML = ''; iArea.innerHTML = '';
        cArea.classList.add('hidden'); iArea.classList.add('hidden');
        document.getElementById('btn-next-manual').classList.add('hidden');

        if (q.type === 'choice') {
            cArea.classList.remove('hidden');
            q.opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = `option-btn ${userData[q.id] === opt ? 'selected' : ''}`;
                btn.innerText = opt;
                btn.onclick = () => { userData[q.id] = opt; currentIdx++; renderQuestion(); };
                cArea.appendChild(btn);
            });
        } else if (q.type === 'multi-input') {
            iArea.classList.remove('hidden');
            document.getElementById('btn-next-manual').classList.remove('hidden');
            q.inputs.forEach(inp => {
                iArea.innerHTML += `
                    <label class="input-label">${inp.label}</label>
                    <input type="${inp.type}" id="inp_${inp.id}" class="kart-input mb-4" placeholder="${inp.p} ì…ë ¥..." value="${userData[inp.id] || ''}">
                `;
            });
        } else if (q.type === 'phone') {
            iArea.classList.remove('hidden');
            document.getElementById('btn-next-manual').classList.remove('hidden');
            iArea.innerHTML = `
                <div class="flex gap-2 items-center justify-center">
                    <input type="text" value="010" readonly class="kart-input w-24 bg-gray-100 text-gray-400">
                    <input type="tel" id="p_body" class="kart-input flex-1" maxlength="8" placeholder="ë‚˜ë¨¸ì§€ 8ìë¦¬ ìˆ«ì" value="${userData['p_body'] || ''}">
                </div>
                <p class="text-[11px] text-gray-400 mt-2 text-center">'-' ì—†ì´ ìˆ«ìë§Œ ì…ë ¥í•´ ì£¼ì„¸ìš”.</p>
            `;
        } else {
            iArea.classList.remove('hidden');
            document.getElementById('btn-next-manual').classList.remove('hidden');
            iArea.innerHTML = `<input type="${q.itype || 'text'}" id="q-input" class="kart-input" placeholder="${q.label}" value="${userData[q.id] || ''}">`;
        }
    }

    function handleNext() {
        const q = questions[currentIdx];
        if (q.type === 'multi-input') {
            let valid = true;
            q.inputs.forEach(inp => {
                const val = document.getElementById(`inp_${inp.id}`).value;
                if(!val) valid = false;
                userData[inp.id] = val;
            });
            if(!valid) return alert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!');
        } else if (q.type === 'phone') {
            const body = document.getElementById('p_body').value;
            if(body.length < 8) return alert('ì—°ë½ì²˜ 8ìë¦¬ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”!');
            userData['p_body'] = body;
            userData['phone'] = `010-${body.substring(0,4)}-${body.substring(4,8)}`;
        } else if (q.type === 'input') {
            const val = document.getElementById('q-input').value;
            if(!val) return alert('ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!');
            userData[q.id] = val;
        }
        currentIdx++;
        renderQuestion();
    }

    function prevStep() { if(currentIdx > 0) { currentIdx--; renderQuestion(); } else { goToRacerSelect(); } }

    async function submitData() {
        /**
         * [ìµœì¢… ìˆ˜ì¹˜ ë¡œì§ ì ìš©] 2026.01.05 ê¸°ì¤€
         * ê¸°ë³¸ê°’: ì›ì²œì†Œë“ * 0.55
         */
        let bonus = 0;
        
        // 2. ì¡°ì§ ê·œëª¨
        const ts = parseInt(userData.team_size || 0);
        if(ts >= 10) bonus += 5; 
        else if(ts >= 5) bonus += 4; 
        else if(ts >= 3) bonus += 3; 
        else if(ts > 0) bonus += 2;

        // 4. ë³´ìœ  ìê²©
        if(userData.license === '+ ê¸ˆìœµ ì „ë¬¸ ìê²©') bonus += 1;

        // 5. ë³´í—˜ ê²½ë ¥
        const cr = userData.career;
        if(cr === '1ë…„ ë¯¸ë§Œ') bonus -= 2;
        else if(cr === '3~5ë…„') bonus += 1;
        else if(cr === '5~10ë…„') bonus += 2;
        else if(cr === '10ë…„ ì´ìƒ') bonus += 3;

        // 7. ì´ì§ íšŸìˆ˜
        const hisStr = userData.history;
        if(hisStr === '1íšŒ') bonus -= 1; 
        else if(hisStr === '2íšŒ') bonus -= 3; 
        else if(hisStr === '3íšŒ ì´ìƒ') bonus -= 5;

        // 8. ì˜ì—… ë°©ì‹
        const sty = userData.style;
        if(sty === 'ì§€ì¸/ì†Œê°œì˜ì—…') bonus += 1; 
        else if(sty === 'DBì˜ì—…') bonus += 3; 
        else if(sty === 'ê¸°íƒ€') bonus += 0.5;

        // 10. ì£¼ë ¥ ìƒí’ˆ
        if(userData.port === 'ë³´ì¥ì„±') bonus += 3; 
        else if(userData.port === 'ì €ì¶•ì„±') bonus += 1;

        // 11. í™œë™ ê¸°ë¡ (W)
        const w = userData.w;
        if(w === '1W 20ì£¼') bonus += 5; 
        else if(w === '2W 20ì£¼') bonus += 10; 
        else if(w === '3W 50ì£¼') bonus += 15;

        // 12. ì›” ê±´ìˆ˜
        const cnt = parseInt(userData.count || 0);
        if(cnt === 0) bonus -= 7; 
        else if(cnt === 1) bonus -= 8; 
        else if(cnt === 2) bonus -= 7; 
        else if(cnt === 3) bonus -= 6;
        else if(cnt >= 11) bonus += 7; 
        else if(cnt >= 8) bonus += 5; 
        else if(cnt >= 5) bonus += 3;

        // 13. ì›” í‰ê·  ë³´í—˜ë£Œ
        const prem = parseInt(userData.premium || 0);
        if(prem >= 100) bonus += 8; 
        else if(prem >= 70) bonus += 6; 
        else if(prem >= 60) bonus += 4.5;
        else if(prem >= 50) bonus += 3; 
        else if(prem >= 40) bonus += 1.5;
        else if(prem < 10) bonus -= 5; 
        else if(prem < 20) bonus -= 3; 
        else if(prem < 30) bonus -= 1;

        // 12.13 ê±´ë‹¹ í‰ê·  ë³´í—˜ë£Œ (9ë‹¨ê³„)
        const avg = prem / (cnt || 1);
        if(avg >= 20) bonus += 6;
        else if(avg >= 15) bonus += 5;
        else if(avg >= 11) bonus += 4;
        else if(avg >= 9) bonus += 3;
        else if(avg >= 7) bonus += 2;
        else if(avg >= 6) bonus += 0;
        else if(avg >= 4) bonus -= 1;
        else if(avg >= 2) bonus -= 1;
        else if(avg < 2) bonus -= 3;

        // 14. MDRT
        const m = userData.mdrt;
        if(m === 'TOT') bonus += 10; 
        else if(m === 'COT') bonus += 7; 
        else if(m === 'MDRT') bonus += 3;

        // 16. ìœ ì§€ìœ¨ (13íšŒì°¨ ê¸°ì¤€ ì„¸ë¶„í™”)
        const p13 = parseInt(userData.p13 || 0);
        if(p13 <= 70) bonus -= 5; 
        else if(p13 <= 75) bonus -= 3; 
        else if(p13 <= 80) bonus -= 1;
        else if(p13 > 95) bonus += 3; 
        else if(p13 > 85) bonus += 1;

        // ìµœì¢… ê³„ì‚°: (ì›ì²œì†Œë“ * 0.55) * (1 + ë³´ë„ˆìŠ¤/100)
        const income = parseInt(userData.income) || 5000;
        const finalVal = Math.round((income * 0.55) * (1 + bonus / 100));

        showScreen('screen-result');
        document.getElementById('res-racer-icon').innerText = userData.racer.icon;
        document.getElementById('finalPrice').innerText = finalVal.toLocaleString();
        document.getElementById('finalPct').innerText = Math.round((finalVal/income)*100);
        document.getElementById('aiAdvice').innerText = `${userData.userName} ë ˆì´ì„œë‹˜, ë¶„ì„ ê²°ê³¼ ë‹¹ì‹ ì˜ ê°€ì¹˜ëŠ” ì‹œì¥ ìƒìœ„ê¶Œì˜ ê¶¤ì ì„ ê·¸ë¦¬ê³  ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ ê°€ì¤‘ì¹˜ ${bonus}% ê°€ì‚°ì€ ë§¤ìš° ìš°ìˆ˜í•œ ì„±ì·¨ì…ë‹ˆë‹¤!`;

        renderRadarChart([Math.min(10, prem/12+2), Math.min(10, avg/2+1), Math.min(10, p13/10), (m!=='ì—†ìŒ'?9:5), Math.min(10, ts/1.5+3)]);

        try {
            const res = await fetch(BACKEND_URL, {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ...userData, final_bounty: finalVal, timestamp: new Date().toLocaleString() })
            });
            const data = await res.json();
            if(data.success) {
                document.getElementById('res-entry-box').style.display = 'block';
                document.getElementById('res-entry-no').innerText = data.entryNo.toString().padStart(3, '0');
                document.getElementById('scoreDisplay').innerText = data.entryNo;
            }
        } catch(e) { console.error(e); }
    }

    function renderRadarChart(data) {
        const ctx = document.getElementById('radarChart').getContext('2d');
        if(radarChart) radarChart.destroy();
        radarChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['ìƒì‚°ì„±', 'íš¨ìœ¨ì„±', 'ìœ ì§€ìœ¨', 'ì „ë¬¸ì„±', 'ë¦¬ë”ì‹­'],
                datasets: [{
                    data: data, backgroundColor: 'rgba(0, 157, 253, 0.2)', borderColor: '#009dfd', borderWidth: 2, pointBackgroundColor: '#fff'
                }]
            },
            options: { scales: { r: { min: 0, max: 10, ticks: { display: false } } }, plugins: { legend: { display: false } }, maintainAspectRatio: false }
        });
    }
</script>
</body>
</html>
